<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enervi7 v7.0 Core + Journey/Oracle/Oils</title>
  <meta name="theme-color" content="#6d28d9" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <style>
    /* ====== Core minimal stylesï¼ˆä¿ç•™ä½ åŸæœ¬çš„é¢¨æ ¼å¯å†ç–ŠåŠ ï¼‰ ====== */
    :root{--bg:#0f0f1a;--card:#161628;--text:#f3f3ff;--muted:#b9b9d6;--brand:#7c3aed;--brand2:#8b5cf6;--ok:#22c55e;--warn:#f59e0b}
    html,body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Helvetica,Arial,sans-serif;margin:0}
    .container{max-width:960px;margin:0 auto;padding:16px 16px 64px}
    header{padding:24px 16px 8px;background:linear-gradient(180deg,#6d28d9 0%,#4c1d95 100%)}
    header h1{margin:0;font-size:28px}
    header .sub{opacity:.9;margin-top:6px;font-size:14px}
    .section{background:var(--card);border-radius:16px;padding:16px;margin:16px 0;border:1px solid rgba(255,255,255,.07)}
    h2{margin:0 0 12px;font-size:20px}
    .small{opacity:.85;font-size:13px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{background:var(--brand);border:none;color:#fff;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn.secondary{background:#2a2a44}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#262645;font-size:12px}
    .ok{color:#10b981}.warn{color:#f59e0b}.muted{color:var(--muted)}
    input[type=range]{width:100%}
    .q{background:#101025;border:1px solid #252545;border-radius:12px;padding:12px;margin:10px 0}
    /* radar svg sizing */
    #radar{width:100%;height:auto;display:block}
    .kvs{display:flex;gap:6px;flex-wrap:wrap}
    .kv{background:#232347;border:1px solid #31315b;border-radius:8px;padding:4px 8px;font-size:12px}
    .badge-row{display:flex;gap:12px;margin-top:8px}
    .badge{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#232347;border:1px solid #2f2f55;position:relative;overflow:hidden}
    .badge img{width:100%;height:100%;object-fit:cover}
    .badge.lock::after{content:"ğŸ”’";position:absolute;font-size:18px}
    .progress{height:10px;background:#232347;border:1px solid #303055;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2))}
    .card{background:#121228;border:1px solid #26264d;padding:12px;border-radius:12px}
    details>summary{cursor:pointer;list-style:none}
    details>summary::-webkit-details-marker{display:none}
    .footer{opacity:.55;text-align:center;margin-top:18px}
  </style>
  <!-- é¡å¤–æ¨£å¼ï¼ˆè‹¥ assets/extras.css å­˜åœ¨æœƒè¦†è“‹å¼·åŒ–ï¼‰ -->
  <link rel="stylesheet" href="assets/extras.css" onerror="this.remove()">
</head>
<body>
<header>
  <div class="container">
    <h1>Enervi7 v7.0 Core</h1>
    <div class="sub">æœ¬ç‰ˆæœ¬ï¼š14 é¡Œé‡è¡¨ + SVG é›·é” + ä¸ƒéšè³‡è¨Šå¡ ï¼‹ æ—…ç¨‹é€²åº¦ / å‘¢å–ƒç¥è«­ / ä»Šæ—¥å»ºè­°ç²¾æ²¹ï¼ˆé›¢ç·šå¯ç”¨ï¼Œä¸ä¾è³´å¤–éƒ¨ CDNï¼‰</div>
  </div>
</header>

<main class="container">

  <!-- æ—…ç¨‹é€²åº¦ï¼ˆæ–°å¢æ¨¡çµ„ï¼‰ -->
  <section class="section">
    <h2>ğŸŒ€ æ—…ç¨‹é€²åº¦</h2>
    <div id="journey-card"></div>
  </section>

  <!-- 14 é¡Œé‡è¡¨ -->
  <section class="section">
    <h2>ğŸ§­ 14 é¡Œé‡è¡¨ï¼ˆ0â€“10ï¼‰</h2>
    <div class="small">0ï¼å®Œå…¨ä¸ç¬¦åˆï¼å¹¾ä¹æ²’æœ‰ã€€ï½œã€€10ï¼éå¸¸ç¬¦åˆï¼å¹¾ä¹ç¸½æ˜¯</div>
    <div id="qs"></div>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="genRadar">ç”Ÿæˆèƒ½é‡åœ–</button>
      <div class="small">ç›®å‰å¹³å‡åˆ†æœƒåæ˜ åˆ°ä¸‹æ–¹è³‡è¨Šå¡èˆ‡é›·é”åœ–ã€‚</div>
    </div>
  </section>

  <!-- é›·é”åœ– -->
  <section class="section">
    <h2>ğŸ“ˆ èƒ½é‡é›·é”åœ–</h2>
    <svg id="radar" viewBox="0 0 420 420" aria-label="èƒ½é‡é›·é”åœ–"></svg>
    <div id="scoresLine" class="small" style="margin-top:8px"></div>
  </section>

  <!-- å‘¢å–ƒç¥è«­ï¼ˆæ–°å¢æ¨¡çµ„ï¼‰ -->
  <section class="section">
    <h2>ğŸ® å‘¢å–ƒç¥è«­ï¼ˆWhispering Oracleï¼‰</h2>
    <div id="oracleBox" class="oracle card"></div>
    <div class="row" style="margin-top:8px">
      <button id="drawOracle" class="btn secondary">æŠ½ä¸€å¼µ</button>
      <div class="small">åŒä¸€å¤©åƒ…é¡¯ç¤ºä¸€å¼µï¼›éš”å¤©è‡ªå‹•åˆ·æ–°ã€‚</div>
    </div>
  </section>

  <!-- ä»Šæ—¥å»ºè­°ç²¾æ²¹ï¼ˆæ–°å¢æ¨¡çµ„ï¼‰ -->
  <section class="section">
    <h2>ğŸª” ä»Šæ—¥å»ºè­°ç²¾æ²¹</h2>
    <div id="oilBox" class="small">è«‹å…ˆå®Œæˆé‡è¡¨ä¸¦ç”Ÿæˆé›·é”åœ–ï¼›ç³»çµ±æœƒæ ¹æ“šæœ€ä½å…©éšæ®µæŒ‘å‡º 2â€“3 æ¬¾å»ºè­°ç²¾æ²¹ã€‚</div>
    <div class="row" style="margin-top:8px">
      <button id="swapOil" class="btn secondary">æ›ä¸€æ¬¾ï¼ˆç¤ºæ„ï¼‰</button>
      <span class="small">é¡¯ç¤ºï¼šè‹±æ–‡åç¨±ï¼ˆå®˜æ–¹ä¸­æ–‡ï¼‰ï¼‹èƒ½é‡æè¿°ã€‚</span>
    </div>
  </section>

  <!-- ä¸ƒéšè³‡è¨Šå¡ï¼ˆè‡ªå‹•å±•é–‹æœ€ä½å…©éšï¼‰ -->
  <section class="section">
    <h2>ğŸŒˆ ä¸ƒéšè³‡è¨Šå¡ï¼ˆè‡ªå‹•å±•é–‹æœ€ä½å…©éšï¼‰</h2>
    <div id="infoCards"></div>
  </section>

  <div class="footer small">Made with ğŸ’œ Enervi7</div>
</main>

<script>
/* =========================
   v7.0 Coreï¼šé¡Œç›®ï¼‹é›·é”ï¼‹è³‡è¨Šå¡
   ========================= */
const STAGES = [
  { key:'ç™½', name:'èƒ½é‡è¦ºçŸ¥' },
  { key:'è—', name:'ç©©å®šèˆ‡æ·¨åŒ–' },
  { key:'æ©™', name:'èƒ½é‡æµå‹•' },
  { key:'é»ƒ', name:'å…§åœ¨åŠ›é‡' },
  { key:'ç¶ ', name:'å…±æŒ¯èˆ‡é€£çµ' },
  { key:'é›è—', name:'æ„è­˜æ“´å±•' },
  { key:'ç´«', name:'éˆé­‚æ•´åˆ' },
];

const QUESTIONS = [
  // â‘  ç™½
  'æˆ‘èƒ½æ¸…æ¥šè¦ºå¯Ÿè‡ªå·±æ­¤åˆ»çš„èº«å¿ƒç‹€æ…‹ã€‚','æˆ‘èƒ½åœ¨æ··äº‚æ™‚ï¼Œè¿…é€ŸæŠŠæ³¨æ„åŠ›å¸¶å›ç•¶ä¸‹ã€‚',
  // â‘¡ è—
  'é¢å°å£“åŠ›æˆ–è¡çªæ™‚ï¼Œæˆ‘èƒ½ä¿æŒå†·éœä¸å¤±è¡¡ã€‚','æˆ‘èƒ½æœ‰æ•ˆåœ°é‡‹æ”¾ç´¯ç©çš„è² é¢æƒ…ç·’èˆ‡é›œå¿µã€‚',
  // â‘¢ æ©™
  'æˆ‘å¸¸æ„Ÿè¦ºéˆæ„Ÿï¼æƒ…æ„Ÿåœ¨é«”å…§è‡ªç„¶æµå‹•ã€‚','æˆ‘èƒ½é †å‹¢èª¿æ•´æ­¥èª¿ï¼Œä¸åƒµç¡¬æˆ–å¡ä½ã€‚',
  // â‘£ é»ƒ
  'åšæ±ºå®šæ™‚ï¼Œæˆ‘èƒ½å …å®šåœ°é¸æ“‡å°è‡ªå·±çœŸçš„å¥½çš„äº‹ã€‚','é‡åˆ°æŒ‘æˆ°ï¼Œæˆ‘ä»èƒ½ç›¸ä¿¡è‡ªå·±ä¸¦å¾€å‰ä¸€æ­¥ã€‚',
  // â‘¤ ç¶ 
  'æˆ‘èƒ½çœŸèª è¡¨é”ï¼Œä¹Ÿæ¨‚æ–¼å‚¾è½ä»–äººã€‚','æˆ‘èƒ½æ„Ÿåˆ°è‡ªå·±èˆ‡ä»–äººã€èˆ‡ä¸–ç•Œæ˜¯é€£çµçš„ã€‚',
  // â‘¥ é›è—
  'æˆ‘ä¿¡ä»»ç›´è¦ºï¼Œä¸”èƒ½å¾ä¸­ç²å¾—æœ‰ç”¨çš„æŒ‡å¼•ã€‚','æˆ‘èƒ½å¾æ—¥å¸¸äº‹ä»¶çœ‹è¦‹æ›´æ·±çš„æ´è¦‹èˆ‡æ„ç¾©ã€‚',
  // â‘¦ ç´«
  'æˆ‘èƒ½æŠŠéå»çš„ç¶“é©—æ•´åˆæˆåŠ›é‡ï¼Œè€Œä¸æ˜¯æ·é–ã€‚','æˆ‘å¸¸æ„Ÿåˆ°è‡ªå·±å®Œæ•´ã€å°ç”Ÿå‘½æ–¹å‘è¸å¯¦å®‰å¿ƒã€‚'
];
// 14 é¡Œï¼šæ¯å…©é¡Œå°æ‡‰ä¸€éš
const sliders = [];
const qsBox = document.getElementById('qs');
for(let i=0;i<14;i++){
  const stageIndex = Math.floor(i/2); // 0..6
  const wrap = document.createElement('div'); wrap.className='q';
  wrap.innerHTML = `
    <div><b>${stageIndex+1}. ${STAGES[stageIndex].key}ï½œ${STAGES[stageIndex].name}</b>ï½œ${QUESTIONS[i]}</div>
    <input type="range" min="0" max="10" step="1" value="5" id="q${i}">
    <div class="small">ç›®å‰ï¼š<span id="qv${i}">5</span> / 10</div>
  `;
  qsBox.appendChild(wrap);
  const input = wrap.querySelector('input');
  const vspan = wrap.querySelector(`#qv${i}`);
  input.addEventListener('input', ()=> vspan.textContent=input.value);
  sliders.push(input);
}

function computeStageAverages(){
  const avgs = Array(7).fill(0);
  for(let s=0;s<7;s++){
    const a = Number(sliders[s*2].value);
    const b = Number(sliders[s*2+1].value);
    avgs[s] = (a+b)/2;
  }
  return avgs;
}

/* ===== Radar SVGï¼ˆç´”å‰ç«¯ã€ä¸ä¾è³´å¤–éƒ¨ CDNï¼‰ ===== */
const radarSVG = document.getElementById('radar');
const scoresLine = document.getElementById('scoresLine');
function drawRadar(values){ // [7] 0..10
  const W=420,H=420,CX=W/2,CY=H/2,R=160, LV=5; // 5 rings
  const N=7, angStep = (Math.PI*2)/N;
  radarSVG.innerHTML='';
  // rings + spokes
  for(let l=1;l<=LV;l++){
    const r=R*l/LV;
    const poly=[];
    for(let i=0;i<N;i++){
      const a=-Math.PI/2 + i*angStep;
      poly.push(`${CX + r*Math.cos(a)},${CY + r*Math.sin(a)}`);
    }
    const g = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    g.setAttribute('points', poly.join(' '));
    g.setAttribute('fill', 'none');
    g.setAttribute('stroke', 'rgba(255,255,255,0.08)');
    radarSVG.appendChild(g);
  }
  for(let i=0;i<N;i++){
    const a=-Math.PI/2 + i*angStep;
    const x=CX + R*Math.cos(a), y=CY + R*Math.sin(a);
    const line=document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',CX); line.setAttribute('y1',CY);
    line.setAttribute('x2',x);  line.setAttribute('y2',y);
    line.setAttribute('stroke','rgba(255,255,255,.08)');
    radarSVG.appendChild(line);
    // label
    const text=document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x',CX + (R+18)*Math.cos(a));
    text.setAttribute('y',CY + (R+18)*Math.sin(a));
    text.setAttribute('dominant-baseline','middle');
    text.setAttribute('text-anchor', Math.cos(a)>0.3?'start':(Math.cos(a)<-0.3?'end':'middle'));
    text.setAttribute('fill','#c8b6ff');
    text.setAttribute('font-size','12');
    text.textContent = `${STAGES[i].key}ï½œ${STAGES[i].name}`;
    radarSVG.appendChild(text);
  }
  // area
  const pts=[];
  for(let i=0;i<N;i++){
    const ratio = (values[i]/10);
    const a=-Math.PI/2 + i*angStep;
    pts.push(`${CX + R*ratio*Math.cos(a)},${CY + R*ratio*Math.sin(a)}`);
  }
  const area=document.createElementNS('http://www.w3.org/2000/svg','polygon');
  area.setAttribute('points',pts.join(' '));
  area.setAttribute('fill','rgba(167,139,250,.25)');
  area.setAttribute('stroke','rgba(167,139,250,.95)');
  area.setAttribute('stroke-width','2');
  radarSVG.appendChild(area);
  scoresLine.textContent = STAGES.map((s,i)=>`${s.key}ï½œ${s.name}ï¼š${values[i].toFixed(1)}`).join(' ï½œ ');
}
document.getElementById('genRadar').addEventListener('click',()=>{
  const vals = computeStageAverages();
  drawRadar(vals);
  saveLastScores(vals);
  renderInfoCards(vals);
  pickTodayOils(vals);
});

/* ===== ä¸ƒéšè³‡è¨Šå¡ï¼ˆè‡ªå‹•å±•é–‹æœ€ä½å…©éšï¼Œå«é—œéµå­—ï¼‹è¡Œå‹•å»ºè­°ï¼‹ç“¶é ¸è½‰æ›ï¼‰ ===== */
const ACTIONS = {
  // åªåˆ— S1, S4, S7, S2, S5, S3, S6ï¼ˆä½ çš„å®Œæ•´ç‰ˆæœ¬å¯æ“´å……æˆ–æŠ½å‡ºåˆ° data/ï¼‰
  'ç™½ï½œèƒ½é‡è¦ºçŸ¥':{
    kw:['è¦ºçŸ¥','æ¸…æ˜','é¢å°ç•¶ä¸‹'],
    act:[
      'å¯«ä¸‰å¥ã€Œæ­¤åˆ»æˆ‘çœŸå¯¦çš„æ„Ÿå—æ˜¯â€¦ã€',
      '3 åˆ†é˜è…¹å¼å‘¼å¸ï¼ˆ4-4-6ï¼‰ï¼Œæ³¨æ„èº«é«”æ„Ÿå—',
      'åˆ—å‡º 1 å€‹åè¦†å¿µé ­ï¼Œæ¨™è¨˜ï¼šæ˜¯äº‹å¯¦é‚„æ˜¯è§£è®€ï¼Ÿ'
    ]
  },
  'è—ï½œç©©å®šèˆ‡æ·¨åŒ–':{
    kw:['ç©©å®š','é‡‹æ”¾','ç•Œç·š'],
    act:[
      'å¯«ä¸‹æœ€å›°æ“¾ä½ çš„ 1 ä»¶äº‹ï¼Œæ¨™è¨»å¯æ§ï¼ä¸å¯æ§',
      'åš 60 ç§’èº«é«”æƒæï¼Œæ”¾é¬†ç·Šç¹ƒéƒ¨ä½',
      'å®Œæˆä¸€ä»¶æ‹–å»¶å°äº‹ä¸¦æ‰“å‹¾'
    ]
  },
  'æ©™ï½œèƒ½é‡æµå‹•':{
    kw:['å…è¨±ç™¼ç”Ÿ','å°é½Šæ„åœ–','è³‡æºæ„Ÿ','å®‰å…¨æ„Ÿ'],
    act:[
      'ç”¨ã€Œæˆ‘å…è¨±â€¦ã€é€ å¥ 3 å¥ï¼ˆå°æ‡‰ä»Šæ—¥ç„¦é»ï¼‰',
      'å›é¡§ 1 æ¬¡è¢«æ”¯æŒçš„è­‰æ“šï¼Œå¯«ä¸‹ç‚ºä½•å¯è¤‡è£½',
      'ä»Šå¤©ä¸»å‹•è«‹æ±‚ä¸€æ¬¡å¹«åŠ©ï¼ˆå°ç¯„åœå³å¯ï¼‰'
    ]
  },
  'é»ƒï½œå…§åœ¨åŠ›é‡':{
    kw:['æœ€å°æ­¥é©Ÿ','å¯é©—è­‰','ç¯€å¥','åŸ·è¡ŒåŠ›'],
    act:[
      'æŠŠç›®æ¨™æ‹†æˆ 10 åˆ†é˜å¯å®Œæˆçš„ä¸€æ­¥ï¼Œç¾åœ¨å°±åš',
      'è¨­å®šä»Šæ—¥ 3 ä»¶ MIT',
      'å®Œæˆå¾Œã€Œå…¬é–‹å›å ±ã€çµ¦å¯ä¿¡ä»»å°è±¡'
    ]
  },
  'ç¶ ï½œå…±æŒ¯èˆ‡é€£çµ':{
    kw:['é€£çµ','åƒ¹å€¼æ„Ÿ','è²¢ç»','æ“´æ•£'],
    act:[
      'åˆ†äº«ä¸€å€‹å°æˆæœæˆ–æ´è¦‹åˆ°ç¤¾ç¾¤ï¼æœ‹å‹',
      'é‚€è«‹ 1 äººçµ¦å…·é«”å›é¥‹ï¼ˆ3 å¥å…·é«”æè¿°ï¼‰',
      'ä¸»å‹•å»ºç«‹ä¸€å€‹åˆä½œå¯èƒ½ï¼ˆç™¼å‡ºä¸€å‰‡é‚€è«‹ï¼‰'
    ]
  },
  'é›è—ï½œæ„è­˜æ“´å±•':{
    kw:['å°ˆæ³¨','å›é¥‹å¾ªç’°','éŸŒæ€§','è¿­ä»£'],
    act:[
      'æŠŠå¡é»â†’èª¿æ•´ 1 å€‹å¾®ç­–ç•¥ï¼ˆA/B å˜—è©¦ï¼‰',
      '25 åˆ†é˜ç•ªèŒ„é˜å…¨ç¨‹å°ˆæ³¨',
      'è¨˜éŒ„ 1 å€‹æœ‰æ•ˆå›é¥‹ï¼Œæ˜å¤©æ²¿ç”¨'
    ]
  },
  'ç´«ï½œéˆé­‚æ•´åˆ':{
    kw:['ç¸½çµç¶“é©—','å›ºåŒ–ç¿’æ…£','çµæ§‹åŒ–','é•·æœŸåŒ–'],
    act:[
      'ç”¨ 5 å¥è©±æ‘˜è¦æœ¬é€± 3 ä»¶å­¸åˆ°ï¼‹1 æ”¹é€²',
      'æŠŠæœ‰æ•ˆæ­¥é©Ÿå¯«æˆ Checklist ä¸¦å›ºå®šåˆ°è¡Œç¨‹',
      'ç‚ºä¸‹å€‹é€±æœŸè¨­å®šä¸€å€‹å¯è¡¡é‡æŒ‡æ¨™ï¼ˆKPIï¼‰'
    ]
  }
};

const TRANSITION = {
  'S1â†’S2':['æŠŠã€Œæˆ‘è§€å¯Ÿåˆ°â€¦ã€æ”¹å¯«æˆã€Œæˆ‘é¡˜æ„æ”¾ä¸‹â€¦ã€Ã—3','æƒ…ç·’æ›¸å¯«â†’èº«é«”æ”¾é¬†æ”¶å°¾ï¼ˆé ¸è‚©ï¼è…¹éƒ¨ï¼‰'],
  'S2â†’S3':['åˆ—å‡º 3 å€‹ç¾æœ‰è³‡æºï¼ˆäººï¼ç‰©ï¼æŠ€èƒ½ï¼‰','å¯« 1 æ®µï¼šè‹¥ä¸€åˆ‡å°æˆ‘æœ‰åˆ©ï¼Œä»Šå¤©æˆ‘å…è¨±ä»€éº¼ï¼Ÿ'],
  'S3â†’S4':['ç”¢å‡ºã€Œæœ€å°å¯è¡Œæ­¥é©Ÿã€ä¸¦åœ¨ 10 åˆ†é˜å…§å•Ÿå‹•','é ç´„ 1 å€‹ã€Œè¡Œå‹•æ™‚æ®µã€ï¼Œè¡Œå‰åªåšæº–å‚™æ¸…å–®'],
  'S4â†’S5':['æŠŠä»Šæ—¥è¡Œå‹•å›é¥‹è¨˜éŒ„ä¸¦åš 1 æ¬¡å¾®èª¿','å»ºç«‹ 25 åˆ†é˜å°ˆæ³¨å„€å¼ï¼ŒçµæŸå›é¡§ 2 åˆ†é˜'],
  'S5â†’S6':['å…¬é–‹åˆ†äº« 1 å€‹é€²å±•ï¼æ¡ˆä¾‹ï¼Œç´¢å–å…·é«”å›é¥‹','è¾¨è­˜æœ€è¢«å…±é³´çš„åƒ¹å€¼ï¼Œæ˜å¤©ä¸»æ‰“è©²å…ƒç´ '],
  'S6â†’S7':['æŠŠæœ‰æ•ˆåšæ³•å¯«æˆ SOPï¼Checklist','é¸ä¸€å€‹å¯æŒçºŒç¯€å¥ï¼ˆé€±ï¼æœˆï¼‰æ”¾é€²è¡Œäº‹æ›†'],
  'S7â†’S1':['æœ¬é€±å›é¡§ 3 å¥ï¼‹ä¸‹ä¸€è¼ªæ–°æ„åœ– 1 å¥','æŒ‘é¸ 1 å€‹æ¬²ç²¾é€²çš„æŒ‡æ¨™ï¼Œè¨­ç½®è§€æ¸¬æ–¹å¼'],
};

function renderInfoCards(values){
  const list = values.map((v,i)=>({i,v})).sort((a,b)=>a.v-b.v);
  const low2 = [list[0].i, list[1].i];
  const box = document.getElementById('infoCards');
  box.innerHTML='';
  low2.forEach(idx=>{
    const title = `${STAGES[idx].key}ï½œ${STAGES[idx].name}`;
    const kvs = ACTIONS[title]?.kw?.map(k=>`<span class="kv">${k}</span>`).join('') || '';
    const acts = (ACTIONS[title]?.act||[]).map(x=>`â€¢ ${x}`).join('<br>');
    const el = document.createElement('details');
    el.open = true;
    el.className='card';
    el.innerHTML = `
      <summary><b>${title}</b> ï½œ å¹³å‡ <b>${values[idx].toFixed(1)}</b> åˆ† <span class="pill">è§€ç…§</span></summary>
      <div style="margin-top:8px">
        <div class="small">é—œéµå­—ï¼š</div>
        <div class="kvs" style="margin:6px 0">${kvs}</div>
        <div class="small">è¡Œå‹•å»ºè­°ï¼š</div>
        <div style="margin-top:6px">${acts||'ä¾ä½ çš„åˆ†æ•¸è¶¨å‹¢ç¨å¾Œè£œå……ã€‚'}</div>
      </div>
    `;
    box.appendChild(el);
  });
  // ç“¶é ¸è½‰æ›ï¼ˆä¾åºé¡¯ç¤º 2 æ¢ï¼‰
  const tBox=document.createElement('div'); tBox.className='card'; tBox.style.marginTop='10px';
  const seq=['S1â†’S2','S2â†’S3','S3â†’S4','S4â†’S5','S5â†’S6','S6â†’S7','S7â†’S1'];
  const lines = seq.slice(0,2).map(k=>`<b>${k}</b>ï¼š${(TRANSITION[k]||[]).map(x=>'â€¢ '+x).join('ã€€')}`);
  tBox.innerHTML = `<div class="small">ç“¶é ¸è½‰æ›æç¤ºï¼š</div><div style="margin-top:6px">${lines.join('<br>')}</div>`;
  box.appendChild(tBox);
}

/* ===== æœ¬åœ°å„²å­˜ä¸Šæ¬¡åˆ†æ•¸ï¼Œç”¨æ–¼ä»Šæ—¥ç²¾æ²¹èˆ‡æ—…ç¨‹åŒæ­¥ ===== */
function saveLastScores(vals){ localStorage.setItem('e7_scores', JSON.stringify(vals)); }
function loadLastScores(){ try{ return JSON.parse(localStorage.getItem('e7_scores')||'[]'); }catch{return []}}

/* =========================
   æ–°æ¨¡çµ„ï¼šæ—…ç¨‹é€²åº¦ / å¾½ç«  / éš±è—å¡
   ========================= */
const JOURNEYS = [
  { key:'d7',  label:'7 æ—¥èƒ½é‡æŒ‘æˆ°',    days:7,  badge:'badge_7.png'  },
  { key:'d21', label:'21 æ—¥éˆé­‚è½‰åŒ–',    days:21, badge:'badge_21.png' },
  { key:'d310',label:'310 æ—¥é¡¯åŒ–æ—¥è¨˜',  days:310,badge:'badge_30.png' },
];

function readJourney(){
  try{ return JSON.parse(localStorage.getItem('e7_journey')||'{}');}catch{return {}}
}
function writeJourney(v){ localStorage.setItem('e7_journey', JSON.stringify(v)); }
function renderJourney(){
  const box=document.getElementById('journey-card'); box.innerHTML='';
  const data = readJourney();
  JOURNEYS.forEach(j=>{
    const done = Number(data[j.key]?.done||0);
    const p = Math.min(100, Math.round(done*100/j.days));
    const row = document.createElement('div'); row.className='card'; row.style.margin='8px 0';
    row.innerHTML = `
      <div class="row" style="justify-content:space-between">
        <div><b>${j.label}</b></div>
        <div class="small">${done} / ${j.days} å¤©</div>
      </div>
      <div class="progress" style="margin:8px 0"><div class="bar" style="width:${p}%"></div></div>
      <div class="row">
        <label class="row small" style="gap:8px;align-items:center">
          <input type="checkbox" id="chk_${j.key}"> å®Œæˆä»Šæ—¥æ‰“å¡
        </label>
        <div class="badge-row">
          <div class="badge ${done<j.days?'lock':''}">
            <img src="${j.badge}" alt="badge">
          </div>
        </div>
      </div>
    `;
    box.appendChild(row);
    row.querySelector(`#chk_${j.key}`).addEventListener('change',e=>{
      if(e.target.checked){
        data[j.key] = { done: Math.min(j.days, done+1), last: new Date().toISOString().slice(0,10) };
        writeJourney(data);
        renderJourney();
        maybeUnlock(j);
      }
    });
  });
}
function maybeUnlock(j){
  const data = readJourney(); const d=data[j.key]?.done||0;
  if(d===j.days){ // è§£é–éš±è—å¡
    showHiddenCard();
  }
}
async function showHiddenCard(){
  let list=[];
  try{ list = await (await fetch('data/hidden_cards.json')).json(); }
  catch{ list = [{title:'ç„¡åä¹‹å…‰', text:'åœ¨ä½ é‚„éœ€è¦åå­—ä¹‹å‰ï¼Œä½ å·²ç¶“æ˜¯å…‰ã€‚', action:'ä»Šå¤©ï¼Œéœé»˜ 60 ç§’ï¼Œè®“è‡ªå·±è¢«çœ‹è¦‹ã€‚'}]; }
  const card = list[Math.floor(Math.random()*list.length)];
  alert(`ğŸ´ éš±è—éˆé­‚å¡ï½œ${card.title}\n\n${card.text}\n\nè¡Œå‹•ï¼š${card.action||'è®“å®ƒæˆç‚ºä»Šå¤©æœ€ç°¡å–®çš„ä¸€æ­¥ã€‚'}`);
}

/* =========================
   æ–°æ¨¡çµ„ï¼šå‘¢å–ƒç¥è«­ï¼ˆæ¯æ—¥ä¸€å¥ + è¡Œå‹•ï¼‰
   ========================= */
function todayKey(prefix){ const d=new Date().toISOString().slice(0,10); return `${prefix}_${d}`; }
async function drawOracle(force=false){
  const k=todayKey('e7_oracle');
  if(!force){
    const cached = localStorage.getItem(k);
    if(cached){ document.getElementById('oracleBox').innerHTML=cached; return; }
  }
  let list=[];
  try{ list = await (await fetch('data/oracle_whispering.json')).json(); }
  catch{
    list = [
      {title:'æˆç‚º', text:'ä½ æ²’æœ‰è®Šå¾—æ›´å¥½ï¼Œåªæ˜¯è®Šå¾—æ›´çœŸã€‚', action:'å…è¨±è‡ªå·±å‡ºç¾ï¼Œå“ªæ€•åªæ˜¯ä¸€åˆ†é˜ã€‚'},
      {title:'æ­¸ä¾†', text:'ä½ èµ°éè¬é‡Œï¼ŒåŸä¾†ä½ ä¸€ç›´éƒ½åœ¨é€™è£¡ã€‚', action:'ä»Šå¤©ï¼Œå°è‡ªå·±èªªï¼šæˆ‘å·²ç¶“å›ä¾†äº†ã€‚'}
    ];
  }
  const pick = list[Math.floor(Math.random()*list.length)];
  const html = `
    <div class="small" style="opacity:.9">ã€Œ${pick.title}ã€</div>
    <div style="margin-top:6px">${pick.text}</div>
    <div class="small" style="margin-top:8px"><b>è¡Œå‹•ï¼š</b>${pick.action||'æŠŠå®ƒè®Šæˆ 1 åˆ†é˜çš„å°æ­¥é©Ÿã€‚'}</div>
  `;
  document.getElementById('oracleBox').innerHTML = html;
  localStorage.setItem(k, html);
}
document.getElementById('drawOracle').addEventListener('click',()=>drawOracle(true));

/* =========================
   æ–°æ¨¡çµ„ï¼šä»Šæ—¥å»ºè­°ç²¾æ²¹ï¼ˆYLï¼‰
   ========================= */
let YL = [];
async function ensureYL(){
  if(YL.length) return YL;
  try{ YL = await (await fetch('data/yl_blends.json')).json(); }
  catch{
    YL = [
      {name:'Peace & Calming', zh_name:'èˆ’éœ', description:'å®‰æ’«æƒ…ç·’ï¼Œå¸¶ä¾†æ·±å±¤å¯§çœ èˆ‡å…§åœ¨å¹³éœã€‚'},
      {name:'Harmony', zh_name:'å’Œè«§ï¼ˆæ¨‚èï¼‰', description:'å¹³è¡¡èº«å¿ƒèƒ½é‡ï¼Œä¿ƒé€²å…§åœ¨èˆ‡é—œä¿‚çš„å”èª¿é€£çµã€‚'},
      {name:'Joy', zh_name:'å–œæ‚…', description:'å–šé†’å…§å¿ƒå–œæ‚…èˆ‡æ„›çš„é »ç‡ï¼Œå¸¶ä¾†å¹¸ç¦æ„Ÿã€‚'},
      {name:'Valor', zh_name:'å‹‡æ°£', description:'æ”¯æ’å…§åœ¨åŠ›é‡ï¼Œå¹«åŠ©ä½ è·¨è¶Šææ‡¼èˆ‡æŒ‘æˆ°ã€‚'},
      {name:'Forgiveness', zh_name:'å¯¬æ•', description:'é‡‹æ”¾éå»çµï¼Œå¸¶ä¾†å¿ƒéˆçš„è‡ªç”±èˆ‡ç™‚ç™’ã€‚'}
    ];
  }
  return YL;
}
function oilBlock(o){ return `<div class="card"><b>${o.name}</b>ï¼ˆ${o.zh_name||'â€”'}ï¼‰<div class="small" style="margin-top:6px">${o.description||''}</div></div>`; }
async function pickTodayOils(vals=loadLastScores()){
  const box=document.getElementById('oilBox');
  if(!vals.length){ box.textContent='è«‹å…ˆå®Œæˆé‡è¡¨ä¸¦ç”Ÿæˆé›·é”åœ–ã€‚'; return; }
  await ensureYL();
  // ä»¥æœ€ä½å…©éšç‚ºä¸»å„çµ¦ 1â€“2 æ¬¾ï¼ˆç¤ºæ„ï¼šéš¨æ©Ÿï¼‰
  const list = vals.map((v,i)=>({i,v})).sort((a,b)=>a.v-b.v);
  const idxs = [list[0].i, list[1].i];
  const picks = [];
  idxs.forEach(i=>{
    // ç°¡å–®éš¨æ©Ÿ 1 æ¬¾ï¼ˆå¯¦å‹™å¯æ˜ å°„åˆ°éšæ®µâ†’ç²¾æ²¹è¡¨ï¼‰
    picks.push(YL[Math.floor(Math.random()*YL.length)]);
  });
  box.innerHTML = picks.map(oilBlock).join('');
}
document.getElementById('swapOil').addEventListener('click',()=>pickTodayOils());

/* =========================
   å•Ÿå‹•
   ========================= */
(function boot(){
  renderJourney();
  drawOracle(false);
  const prev = loadLastScores();
  if(prev.length){ drawRadar(prev); renderInfoCards(prev); pickTodayOils(prev); }
})();
</script>

<!-- é¡å¤– JSï¼ˆè‹¥ä½ æœ‰åˆ†æ‹†çš„ extras.jsï¼Œå¯ä¿ç•™ï¼›æ²’æœ‰å°±å¿½ç•¥ï¼‰ -->
<script src="extras.js" onerror="this.remove()"></script>

<!-- PWAï¼ˆä½ æ—¢æœ‰çš„ sw.js å¯æ²¿ç”¨ï¼‰ -->
<script>
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
</script>
</body>
</html>