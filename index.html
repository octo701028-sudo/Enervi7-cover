<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enervi7 v7 Journey Core</title>

<style>
  :root{
    --bg:#0f0c18;
    --panel:#171427;
    --text:#f1ecff;
    --muted:#b8b6c9;
    --brand:#7a3cff;
    --brand-2:#5ee2ff;
    --ok:#36d399;
    --warn:#ffbf5e;
    --danger:#ff6b6b;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI","PingFang TC","Noto Sans TC",Roboto,"Helvetica Neue",Arial,sans-serif;}
  .wrap{max-width:880px;margin:24px auto 80px;padding:0 16px;}
  h1{margin:0 0 8px;font-size:28px;font-weight:800}
  .sub{color:var(--muted);font-size:14px;margin-bottom:18px}

  /* 面板 */
  .card{background:var(--panel);border-radius:14px;padding:18px 16px;margin:16px 0;box-shadow:0 6px 24px rgba(0,0,0,.25)}
  .row{display:flex;gap:12px;align-items:center}
  .muted{color:var(--muted)}
  .btn{padding:10px 14px;border-radius:10px;border:0;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#2a2550}
  .tag{font-size:12px;padding:4px 8px;border-radius:999px;background:#2a2550;color:#d8d6f6}

  /* 進度條 */
  .bar{height:10px;background:#231d3e;border-radius:20px;overflow:hidden}
  .bar > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:width .5s ease}

  /* 勳章 / 鎖頭 */
  .badge{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;background:#1d1934;position:relative;box-shadow:inset 0 0 0 2px #2d265a}
  .badge svg{width:26px;height:26px;opacity:.9}
  .badge.locked svg path{fill:#7b78a3}
  .badge.unlocked{animation:pop .5s ease both}
  @keyframes pop{0%{transform:scale(.6)}60%{transform:scale(1.15)}100%{transform:scale(1)}}

  /* 解鎖光暈 */
  .badge.unlock::before{
    content:"";position:absolute;inset:-4px;border-radius:inherit;
    background:radial-gradient( circle at 50% 50%, rgba(122,60,255,.55), transparent 60%);
    filter:blur(6px);animation:glow 1.8s ease-in-out 2;
  }
  @keyframes glow{
    0%,100%{opacity:.2;transform:scale(.95)}
    50%{opacity:1;transform:scale(1.05)}
  }

  /* 勾選 (每日打卡) */
  .check{appearance:none;width:22px;height:22px;border-radius:6px;margin-right:8px;
         border:2px solid #3a3463;background:transparent;cursor:pointer}
  .check:checked{background:var(--ok);border-color:var(--ok)}

  /* 對話框 */
  dialog{border:0;border-radius:16px;padding:0;background:#181532;color:var(--text);max-width:520px}
  dialog::backdrop{background:rgba(0,0,0,.55)}
  .dlg-hd{padding:16px 18px;border-bottom:1px solid #2b2650;font-weight:800;display:flex;justify-content:space-between}
  .dlg-bd{padding:16px 18px}
  .dlg-ft{padding:14px 18px;border-top:1px solid #2b2650;text-align:right}
  .x{background:#2a2550;border:0;color:#eae6ff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}

  /* 小字 */
  .sm{font-size:13px;color:var(--muted)}

  /* 日曆小圓點 */
  .dot{width:8px;height:8px;background:#3a3463;border-radius:50%}
  .dot.on{background:var(--ok)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Enervi7 ｜旅程進度</h1>
  <div class="sub">本區塊：7／21／30 天打卡進度＋解鎖動畫＋每日僅能打卡一次（同日重複無效）</div>

  <!-- 旅程進度 -->
  <div class="card">
    <h2>🌀 旅程進度</h2>

    <div class="card" style="background:#14112a;border-radius:12px">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="row">
          <div class="tag">7 日能量挑戰</div>
        </div>
        <div class="muted"><span id="d7">0</span> / 7 天</div>
      </div>
      <div class="bar"><span id="p7"></span></div>
      <div class="row" style="margin-top:12px;justify-content:space-between">
        <label class="row sm"><input class="check" type="checkbox" id="tick7" />完成今日打卡</label>
        <div class="badge locked" id="b7" title="解鎖後顯示卡片">
          <!-- 鎖頭 SVG -->
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 2a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V7a5 5 0 00-5-5zm0 2a3 3 0 013 3v3H9V7a3 3 0 013-3z" fill="#9a96c7"/></svg>
        </div>
      </div>
    </div>

    <div class="card" style="background:#14112a;border-radius:12px">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="row">
          <div class="tag">21 日靈魂轉化</div>
        </div>
        <div class="muted"><span id="d21">0</span> / 21 天</div>
      </div>
      <div class="bar"><span id="p21"></span></div>
      <div class="row" style="margin-top:12px;justify-content:space-between">
        <label class="row sm"><input class="check" type="checkbox" id="tick21" />完成今日打卡</label>
        <div class="badge locked" id="b21">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 2a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V7a5 5 0 00-5-5z" fill="#9a96c7"/></svg>
        </div>
      </div>
    </div>

    <div class="card" style="background:#14112a;border-radius:12px">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="row">
          <div class="tag">30 日顯化日記</div>
        </div>
        <div class="muted"><span id="d30">0</span> / 30 天</div>
      </div>
      <div class="bar"><span id="p30"></span></div>
      <div class="row" style="margin-top:12px;justify-content:space-between">
        <label class="row sm"><input class="check" type="checkbox" id="tick30" />完成今日打卡</label>
        <div class="badge locked" id="b30">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 2a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V7a5 5 0 00-5-5z" fill="#9a96c7"/></svg>
        </div>
      </div>
    </div>

    <div class="sm" style="margin-top:8px">小提醒：同一天只會記錄一次打卡；跨日才會累加。</div>
  </div>
</div>

<!-- 解鎖彈窗 -->
<dialog id="unlockDlg">
  <div class="dlg-hd">
    <div>🃏 隱藏靈魂卡</div>
    <button class="x" onclick="unlockDlg.close()">關閉</button>
  </div>
  <div class="dlg-bd">
    <div id="cardTitle" style="font-weight:800;font-size:18px;margin-bottom:6px"></div>
    <div id="cardText" style="white-space:pre-wrap"></div>
  </div>
  <div class="dlg-ft"><button class="x" onclick="unlockDlg.close()">好的</button></div>
</dialog>

<script>
/* =========================
   1) 33 張隱藏靈魂卡
   ========================= */
const HIDDEN_CARDS = [
  {t:"無名之光", m:"在你還需要名字之前，你已經是光。\n行動：今天，靜默 60 秒，讓自己被看見。"},
  {t:"回到中心", m:"你不是風暴，你是中心。讓萬象繞你轉，而你安住其中。"},
  {t:"允許發生", m:"收起掌控，讓生命與你一起完成今天。\n行動：寫下 3 句『我允許…』"},
  {t:"含光而行", m:"溫柔不等於退讓；你是含著光的山。"},
  {t:"回答自己的名字", m:"你呼喚了誰？其實你在呼喚自己。"},
  {t:"還給時間", m:"把急躁還給時間，把清明還給自己。"},
  {t:"看見足夠", m:"你已經擁有完成今天的『足夠』。"},
  {t:"微小步", m:"一粒沙也能推動風向。\n行動：10 分鐘完成一小步。"},
  {t:"就在此刻", m:"最合適的起點，總是此刻。"},
  {t:"照見", m:"你不是被定義，你是會發光的『證據』。"},
  {t:"靈魂呼氣", m:"吐出不是你的，空出能盛裝的。"},
  {t:"做你的河", m:"不與海爭，卻總能抵達海。"},
  {t:"扶著心", m:"給心一把椅子，讓它坐下說話。"},
  {t:"把愛說完", m:"你以為太多，其實剛好。"},
  {t:"席地而坐", m:"停止奔跑，地板也是抵達。"},
  {t:"交還重擔", m:"不是你的，就讓它歸位。"},
  {t:"給出請求", m:"向外伸手，本身就是勇氣。"},
  {t:"慢一點", m:"快是方法，慢是力量。"},
  {t:"收回目光", m:"你把世界看得太多，今天看回自己。"},
  {t:"一致", m:"心、口、手同一方向，就會有風。"},
  {t:"安穩", m:"你不是勉強自己，而是陪伴自己。"},
  {t:"穿越噪音", m:"把『別人的聲音』關小，讓內在指引變大。"},
  {t:"換位", m:"站到愛的位置，就看見路。"},
  {t:"河口", m:"結束不是終點，是另一段流的開始。"},
  {t:"種子日", m:"今天的一點點，就是明天的一整片。"},
  {t:"允許喜悅", m:"快樂不是成果，是方法。"},
  {t:"把手鬆開", m:"鬆開不是失去，是為接住做準備。"},
  {t:"為自己作證", m:"寫下 3 個『我做到了』。"},
  {t:"沉著的心", m:"慌只是暫時；深處一直很穩。"},
  {t:"先相信", m:"不是因為看見才相信，而是相信所以看見。"},
  {t:"回家", m:"歸返，不必遠行。"},
  {t:"同行", m:"把今天分享給一個人，路會變亮。"},
  {t:"許可", m:"准許自己是現在這樣，世界才好好愛你。"}
];

/* =========================
   2) 本地狀態儲存
   ========================= */
const LS = {
  get(k, d){ try{ return JSON.parse(localStorage.getItem(k) ?? JSON.stringify(d)); }catch(e){ return d; } },
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
};

// 旅程 key
const KEY = "enervi7_journey_v2";
const todayStr = ()=> new Date().toISOString().slice(0,10);

// 讀取或初始化
const state = LS.get(KEY, {
  d7:0, d21:0, d30:0,
  lastCheckinDate:null,
  unlockedIndex:0, // 已解鎖至第幾張卡（對應 HIDDEN_CARDS）
  unlocked7:false, unlocked21:false, unlocked30:false
});

/* =========================
   3) 繪製 UI
   ========================= */
function render(){
  // 數字
  d7.textContent   = state.d7;
  d21.textContent  = state.d21;
  d30.textContent  = state.d30;

  // 進度
  p7.style.width   = Math.min(state.d7/7*100, 100) + "%";
  p21.style.width  = Math.min(state.d21/21*100, 100) + "%";
  p30.style.width  = Math.min(state.d30/30*100, 100) + "%";

  // 今日是否已打卡（三條同一個日期）
  const done = state.lastCheckinDate === todayStr();
  tick7.checked = done; tick21.checked = done; tick30.checked = done;

  // 勳章鎖頭
  setBadge(b7, state.unlocked7);
  setBadge(b21, state.unlocked21);
  setBadge(b30, state.unlocked30);
}

function setBadge(el, unlocked){
  el.classList.remove("unlock");
  if(unlocked){
    el.classList.remove("locked");
    el.classList.add("unlocked","unlock"); // unlock 會觸發光暈動畫
    // 換圖示（開鎖）
    el.innerHTML = `<svg viewBox="0 0 24 24" fill="none">
      <path d="M17 10V7a5 5 0 10-10 0h2a3 3 0 116 0v3h-1a2 2 0 00-2 2v8a2 2 0 002 2h4a2 2 0 002-2v-8a2 2 0 00-2-2h-1z" fill="#c7b6ff"/></svg>`;
  }else{
    el.classList.add("locked");
    el.classList.remove("unlocked");
    el.innerHTML = `<svg viewBox="0 0 24 24" fill="none">
      <path d="M12 2a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V7a5 5 0 00-5-5zm0 2a3 3 0 013 3v3H9V7a3 3 0 013-3z" fill="#9a96c7"/></svg>`;
  }
}

/* =========================
   4) 打卡（每日僅一次）
   ========================= */
function checkinToday(){
  // 已打過卡就不再計數
  if(state.lastCheckinDate === todayStr()){
    // 只把 UI 的勾選同步，不加天數
    tick7.checked = true; tick21.checked = true; tick30.checked = true;
    return;
  }

  state.lastCheckinDate = todayStr();
  // 三條都 +1
  state.d7 = Math.min(state.d7+1, 7);
  state.d21 = Math.min(state.d21+1, 21);
  state.d30 = Math.min(state.d30+1, 30);

  // 是否解鎖
  const unlocks = [];
  if(state.d7 === 7 && !state.unlocked7){ state.unlocked7 = true; unlocks.push("7"); }
  if(state.d21 === 21 && !state.unlocked21){ state.unlocked21 = true; unlocks.push("21"); }
  if(state.d30 === 30 && !state.unlocked30){ state.unlocked30 = true; unlocks.push("30"); }

  // 儲存 + 重繪
  LS.set(KEY, state);
  render();

  // 若有解鎖 → 顯示卡牌（每次只顯示一張，若多個同時解鎖就依序顯示一張）
  if(unlocks.length){
    showHiddenCard();
  }
}

/* =========================
   5) 顯示隱藏卡（依序取用）
   ========================= */
function showHiddenCard(){
  const idx = state.unlockedIndex % HIDDEN_CARDS.length;
  const card = HIDDEN_CARDS[idx];
  state.unlockedIndex++;
  LS.set(KEY, state);

  cardTitle.textContent = `${card.t}`;
  cardText.textContent  = card.m;
  unlockDlg.showModal();
}

/* =========================
   6) 綁定三個 checkbox
   （任一顆勾選都視為『今日打卡』）
   ========================= */
["tick7","tick21","tick30"].forEach(id=>{
  document.getElementById(id).addEventListener("change", e=>{
    if(e.target.checked) checkinToday(); else render();
  });
});

// 初次渲染
render();
</script>
</body>
</html>